<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>R·∫Øn SƒÉn M·ªìi Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #141e30, #243b55);
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }
    .screen {
      position: absolute;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
    }
    .screen.active { display: flex; }
    h1 { font-size: 40px; margin-bottom: 20px; }
    button {
      padding: 12px 28px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #00ff99;
    }
    canvas {
      background: #000;
      border: 4px solid #00ff99;
      touch-action: none;
    }
    .hud { margin-top: 10px; font-size: 18px; }
    #fullscreenBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 999;
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 8px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      border: 1px solid #00ff99;
    }
  </style>
</head>
<body><button id="fullscreenBtn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>

<div id="startScreen" class="screen active">
  <h1>üêç R·∫ÆN SƒÇN M·ªíI</h1>
  <p>Vu·ªët ƒë·ªÉ ƒëi·ªÅu khi·ªÉn ‚Ä¢ Ph√≠m m≈©i t√™n</p>
  <button onclick="startGame()">START</button>
</div><div id="gameScreen" class="screen">
  <canvas id="game" width="480" height="480"></canvas>
  <div class="hud">ƒêi·ªÉm: <span id="score">0</span> | Cao nh·∫•t: <span id="highScore">0</span></div>
</div><div id="gameOverScreen" class="screen">
  <h1>üíÄ GAME OVER</h1>
  <p>ƒêi·ªÉm c·ªßa b·∫°n: <span id="finalScore">0</span></p>
  <button onclick="restartGame()">RESTART</button>
</div><script>
  const startScreen = document.getElementById('startScreen');
  const gameScreen = document.getElementById('gameScreen');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const highScoreEl = document.getElementById('highScore');
  const finalScoreEl = document.getElementById('finalScore');

  const box = 24;
  const size = canvas.width / box;
  const highScoreKey = 'snake_high_score';
  let highScore = Number(localStorage.getItem(highScoreKey)) || 0;

  let snake, direction, food, score, loop;

  function showScreen(s) {
    startScreen.classList.remove('active');
    gameScreen.classList.remove('active');
    gameOverScreen.classList.remove('active');
    s.classList.add('active');
  }

  function startGame() {
    showScreen(gameScreen);
    initGame();
    loop = setInterval(updateGame, 120);
  }

  function restartGame() {
    showScreen(gameScreen);
    initGame();
    loop = setInterval(updateGame, 120);
  }

  function initGame() {
    clearInterval(loop);
    snake = [{ x: 10, y: 10 }];
    direction = 'RIGHT';
    food = randomFood();
    score = 0;
    scoreEl.textContent = score;
    highScoreEl.textContent = highScore;
  }

  document.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft' && direction !== 'RIGHT') direction = 'LEFT';
    if (e.key === 'ArrowUp' && direction !== 'DOWN') direction = 'UP';
    if (e.key === 'ArrowRight' && direction !== 'LEFT') direction = 'RIGHT';
    if (e.key === 'ArrowDown' && direction !== 'UP') direction = 'DOWN';
  });

  let tx = 0, ty = 0;
  canvas.addEventListener('touchstart', e => {
    const t = e.touches[0]; tx = t.clientX; ty = t.clientY;
  });

  canvas.addEventListener('touchend', e => {
    const t = e.changedTouches[0];
    const dx = t.clientX - tx;
    const dy = t.clientY - ty;
    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 0 && direction !== 'LEFT') direction = 'RIGHT';
      if (dx < 0 && direction !== 'RIGHT') direction = 'LEFT';
    } else {
      if (dy > 0 && direction !== 'UP') direction = 'DOWN';
      if (dy < 0 && direction !== 'DOWN') direction = 'UP';
    }
  });

  function randomFood() {
    return { x: Math.floor(Math.random() * size), y: Math.floor(Math.random() * size) };
  }

  function drawSnake() {
    snake.forEach((p, i) => {
      const x = p.x * box;
      const y = p.y * box;
      ctx.fillStyle = i === 0 ? '#2ecc71' : '#27ae60';
      ctx.fillRect(x + 1, y + 1, box - 2, box - 2);
      if (i === 0) {
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(x + box * 0.3, y + box * 0.35, 2, 0, Math.PI * 2);
        ctx.arc(x + box * 0.7, y + box * 0.35, 2, 0, Math.PI * 2);
        ctx.fill();
      }
    });
  }

  function drawApple() {
    const ax = food.x * box + box / 2;
    const ay = food.y * box + box / 2;
    ctx.fillStyle = '#e53935';
    ctx.beginPath();
    ctx.arc(ax, ay, box / 2 - 3, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(255,255,255,0.4)';
    ctx.beginPath();
    ctx.arc(ax - 4, ay - 4, box / 6, 0, Math.PI * 2);
    ctx.fill();
  }

  function updateGame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawApple();
    drawSnake();

    let head = { ...snake[0] };
    if (direction === 'LEFT') head.x--;
    if (direction === 'RIGHT') head.x++;
    if (direction === 'UP') head.y--;
    if (direction === 'DOWN') head.y++;

    if (head.x === food.x && head.y === food.y) {
      score++;
      scoreEl.textContent = score;
      food = randomFood();
    } else snake.pop();

    if (head.x < 0 || head.y < 0 || head.x >= size || head.y >= size) return gameOver();
    for (let p of snake) if (head.x === p.x && head.y === p.y) return gameOver();

    snake.unshift(head);
  }

  function gameOver() {
    clearInterval(loop);
    if (score > highScore) {
      highScore = score;
      localStorage.setItem(highScoreKey, highScore);
    }
    finalScoreEl.textContent = score;
    showScreen(gameOverScreen);
  }

  function toggleFullscreen() {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  }
</script></body>

</html>
